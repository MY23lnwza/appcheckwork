<!-- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¸›à¸£à¸±à¸šà¸«à¸¥à¸±à¸à¹† à¸„à¸·à¸­à¹ƒà¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ renderTasks() à¹ƒà¸«à¹‰à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ à¹à¸¥à¸°à¹à¸à¹‰à¹„à¸‚à¸›à¸¸à¹ˆà¸¡/textarea à¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡ -->
<script>
  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸Šà¹ˆà¸§à¸¢à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸£à¸¹à¸›à¹à¸šà¸š "à¸§à¸±à¸™/à¹€à¸”à¸·à¸­à¸™/à¸›à¸µ" à¸ à¸²à¸©à¸²à¹„à¸—à¸¢
  function formatDate(dateStr) {
    if (!dateStr) return "-";
    const d = new Date(dateStr);
    if (isNaN(d)) return dateStr; // à¸à¸£à¸“à¸µà¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸£à¸´à¸‡
    return d.toLocaleDateString("th-TH");
  }

  // ... à¸ªà¹ˆà¸§à¸™à¸­à¸·à¹ˆà¸™à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ...

  function renderTasks() {
    const adminDiv = document.getElementById("adminTasks");
    const userDiv = document.getElementById("userTasks");
    const userSub = document.getElementById("userSubmitted");
    adminDiv.innerHTML = "";
    userDiv.innerHTML = "";
    userSub.innerHTML = "";

    tasks.forEach((t) => {
      // à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¸à¹ˆà¸­à¸™à¹à¸ªà¸”à¸‡
      const orderDateFormatted = formatDate(t.orderDate);
      const dueFormatted = formatDate(t.due);
      const submitDateFormatted = formatDate(t.submitDate);

      // à¸à¸³à¸«à¸™à¸”à¸„à¸¥à¸²à¸ªà¸ªà¸–à¸²à¸™à¸°à¸ªà¸µ
      const statusClass =
        t.status === "approved"
          ? "status-green"
          : t.status === "edit"
          ? "status-orange"
          : "status-yellow";

      const baseInfo = `
        <div class="card" style="margin-bottom: 0.7rem;">
          <h4>${t.title}</h4>
          <p>ğŸ‘¤ à¸œà¸¹à¹‰à¸£à¸±à¸š: ${t.assignTo} | ğŸ“… à¸ªà¸±à¹ˆà¸‡à¸‡à¸²à¸™: ${orderDateFormatted} | ğŸ“… à¸à¸³à¸«à¸™à¸”à¸ªà¹ˆà¸‡: ${dueFormatted}</p>
          <p>ğŸ”— <a href="${t.brief || "#"}" target="_blank">à¸šà¸£à¸µà¸Ÿ</a></p>
          <p>${t.adminNote ? "ğŸ“Œ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: " + t.adminNote : ""}</p>
          <p class="${statusClass}">à¸ªà¸–à¸²à¸™à¸°: ${t.status}</p>
      `;

      if (currentRole === "admin") {
        adminDiv.innerHTML +=
          baseInfo +
          `
          <p>ğŸ›  à¸¥à¸´à¸‡à¸à¹Œà¸‡à¸²à¸™: <a href="${t.workLink || "#"}" target="_blank">${t.workLink || "-"}</a></p>
          <textarea placeholder="à¸„à¸­à¸¡à¹€à¸¡à¸™à¸•à¹Œ" oninput="this.dataset.val=this.value"></textarea>
          <button onclick="updateStatus(${t.id}, 'approved', this.previousElementSibling.dataset.val)">âœ” à¸œà¹ˆà¸²à¸™</button>
          <button onclick="updateStatus(${t.id}, 'edit', this.previousElementSibling.dataset.val)">âœ à¹à¸à¹‰à¹„à¸‚</button>
          <button style="background:#f44336;" onclick="deleteTask(${t.id})">ğŸ—‘ à¸¥à¸š</button>
        </div>
        `;
      } else if (
        currentRole === "user" &&
        t.assignTo.toLowerCase() === currentUser.toLowerCase()
      ) {
        if (t.status === "assigned" || t.status === "edit") {
          userDiv.innerHTML +=
            baseInfo +
            `
            <textarea placeholder="à¸¥à¸´à¸‡à¸à¹Œà¸‡à¸²à¸™" oninput="this.dataset.link=this.value"></textarea>
            <textarea placeholder="à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸" oninput="this.dataset.note=this.value"></textarea>
            <button onclick="submitWork(${t.id}, this.previousElementSibling.previousElementSibling.dataset.link, this.previousElementSibling.dataset.note)">ğŸ“¤ à¸ªà¹ˆà¸‡à¸‡à¸²à¸™</button>
          </div>
          `;
        } else if (t.status === "submitted" || t.status === "approved") {
          userSub.innerHTML +=
            baseInfo +
            `
            <p>ğŸ’¬ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: ${t.note || "-"}</p>
            <p>ğŸ—’ à¸„à¸­à¸¡à¹€à¸¡à¸™à¸•à¹Œ: ${t.comment || "-"}</p>
            <p>ğŸ“… à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¹€à¸¡à¸·à¹ˆà¸­: ${submitDateFormatted}</p>
          </div>
          `;
        }
      }
    });
  }
</script>
