<!-- ส่วนที่ปรับหลักๆ คือในฟังก์ชัน renderTasks() ให้แปลงวันที่ และแก้ไขปุ่ม/textarea ให้ตรงกับข้อมูลจริง -->
<script>
  // ฟังก์ชันช่วยแปลงวันที่ให้เป็นรูปแบบ "วัน/เดือน/ปี" ภาษาไทย
  function formatDate(dateStr) {
    if (!dateStr) return "-";
    const d = new Date(dateStr);
    if (isNaN(d)) return dateStr; // กรณีไม่ใช่วันที่จริง
    return d.toLocaleDateString("th-TH");
  }

  // ... ส่วนอื่นเหมือนเดิม ...

  function renderTasks() {
    const adminDiv = document.getElementById("adminTasks");
    const userDiv = document.getElementById("userTasks");
    const userSub = document.getElementById("userSubmitted");
    adminDiv.innerHTML = "";
    userDiv.innerHTML = "";
    userSub.innerHTML = "";

    tasks.forEach((t) => {
      // แปลงวันที่ก่อนแสดง
      const orderDateFormatted = formatDate(t.orderDate);
      const dueFormatted = formatDate(t.due);
      const submitDateFormatted = formatDate(t.submitDate);

      // กำหนดคลาสสถานะสี
      const statusClass =
        t.status === "approved"
          ? "status-green"
          : t.status === "edit"
          ? "status-orange"
          : "status-yellow";

      const baseInfo = `
        <div class="card" style="margin-bottom: 0.7rem;">
          <h4>${t.title}</h4>
          <p>👤 ผู้รับ: ${t.assignTo} | 📅 สั่งงาน: ${orderDateFormatted} | 📅 กำหนดส่ง: ${dueFormatted}</p>
          <p>🔗 <a href="${t.brief || "#"}" target="_blank">บรีฟ</a></p>
          <p>${t.adminNote ? "📌 หมายเหตุ: " + t.adminNote : ""}</p>
          <p class="${statusClass}">สถานะ: ${t.status}</p>
      `;

      if (currentRole === "admin") {
        adminDiv.innerHTML +=
          baseInfo +
          `
          <p>🛠 ลิงก์งาน: <a href="${t.workLink || "#"}" target="_blank">${t.workLink || "-"}</a></p>
          <textarea placeholder="คอมเมนต์" oninput="this.dataset.val=this.value"></textarea>
          <button onclick="updateStatus(${t.id}, 'approved', this.previousElementSibling.dataset.val)">✔ ผ่าน</button>
          <button onclick="updateStatus(${t.id}, 'edit', this.previousElementSibling.dataset.val)">✏ แก้ไข</button>
          <button style="background:#f44336;" onclick="deleteTask(${t.id})">🗑 ลบ</button>
        </div>
        `;
      } else if (
        currentRole === "user" &&
        t.assignTo.toLowerCase() === currentUser.toLowerCase()
      ) {
        if (t.status === "assigned" || t.status === "edit") {
          userDiv.innerHTML +=
            baseInfo +
            `
            <textarea placeholder="ลิงก์งาน" oninput="this.dataset.link=this.value"></textarea>
            <textarea placeholder="หมายเหตุ" oninput="this.dataset.note=this.value"></textarea>
            <button onclick="submitWork(${t.id}, this.previousElementSibling.previousElementSibling.dataset.link, this.previousElementSibling.dataset.note)">📤 ส่งงาน</button>
          </div>
          `;
        } else if (t.status === "submitted" || t.status === "approved") {
          userSub.innerHTML +=
            baseInfo +
            `
            <p>💬 หมายเหตุ: ${t.note || "-"}</p>
            <p>🗒 คอมเมนต์: ${t.comment || "-"}</p>
            <p>📅 ส่งคืนเมื่อ: ${submitDateFormatted}</p>
          </div>
          `;
        }
      }
    });
  }
</script>
